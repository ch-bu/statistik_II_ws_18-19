---
title: "Statistik II - Nachbereitungsaufgabe"
subtitle: "04 Statistisches Hypothesentesten II"
author: ""
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Revision deiner Erklärung zum Thema Statistisches Hypothesentesten II

Als Vorbereitungsaufgaben hast du eine Erklärung zum Thema Statistisches Hypothesentesten II geschrieben. Nun sollst du diese Erklärung revidieren. Revidieren bedeutet, dass du (1) deine Erklärung auf Richtigkeit und Korrektheit überprüfst, und (2) deine Erklärung nach den Kriterien der Richtigkeit und Korrektheit überarbeitest. 

Verwende für die Revision das **visuelle Feedback**, welches dir über [Slack](https://statistik-2.slack.com/messages/CCN7ZMYE6) zur Verfügung gestellt wird. Versuche aus dem visuellen Feedback folgende Leitfragen zu beantworten und in deiner Revision einzupflegen:

* Hast du in das übergeordnete Thema deiner Erklärung eingeführt? 
* Hast du die relevanten Konzepte deiner Erklärung benannt und ausreichend erklärt? 
* Hast du die relevanten Konzepte deiner Erklärung logisch und sinnvoll miteinander verbunden?
* Hast du die relevanten Konzepte deiner Erklärung durch gute Beispiele illustriert?

Nimm dir für die Revision deiner Erklärung in etwa 45 Minuten Zeit und versuche auf die Erklärung hinsichtlich dieser Leitfragen zu überarbeiten. 

> TODO: Füge hier deine revidierte Erklärung ein.


## Fragen zur Revision

Wie lange hast du an der Revision geschrieben? 

> TODO: Bitte in Minuten angeben

Wie stark hast du dich gerade bei der Revisions der Erklärung angestrengt (1: Sehr stark angestrengt; 9: gar nicht angestrengt)?  

> TODO: Bitte Antwort hier eintragen

Wie schwierig war es für dich die Erklärung zu revidieren (1: Sehr schwierig, 9 gar nicht schwierig)? 

> TODO: Bitte Antwort hier eintragen

Wie verständlich schätzt du deine revidierte Erklärung ein (1: Sehr verständlich; 5 gar nicht verständlich)? 

> TODO: Bitte Antwort hier eintragen

Wie gut konntest du auf Grundlage des visuellen Feedbacks Revisionen ableiten (1: Gar nicht, 2: wenig, 3: mittelmäßig, 4: gut, 5 sehr gut)? 

> TODO: Bitte in Minuten angeben


# R-Anwendungsaufgaben

```{r}
# TODO: Lade Tidyverse
```

PISA ist eine internationale Schulstudie, welche in einem dreijährigen Turnus von der Gemeinschaft für Wirtschaftliche Zusammenarbeit (OECD) durchgeführt wird. Unter anderem erhebt PISA den Leistungsstand von Schüler\*innen in der Lese- und Rechtschreibfähigkeit, sowie in der Fähigkeit wissenschaftliche Sachverhalte zu begreifen. 

In dieser Anwendungsaufgabe werden wir den Datensatz im Detail analysieren und dadurch deine Fähigkeiten, Daten mit R zu analysieren versuchen zu verbessern. Der Datensatz heißt `pisa.csv`. 

Zunächst laden wir den Datensatz:

```{r}
# TODO: Datensatz mit read_csv einlesen und der Variable pisa zuordnen
```

Wie viele Reihen und Spalten hat der Datensatz? 

```{r}
# ToDO: Verwende die dim Funktion, um die Reihen und Spalten zu erhalten
```

Welche Variablen umfasst der Datensatz?

```{r}
# TODO: Verwende glimpse, um den Datensatz zu betrachten
#       https://tibble.tidyverse.org/reference/glimpse.html
```

## Datenbereinigung

Der Datensatz enthält ein paar Variablen, welche wir später nicht mehr brauchen werden. Entferne daher folgende Variablen: `Country Code`, `Series Code`, `2013 [YR2013]` und `2014 [YR2014]`.

```{r}
# TODO: Entferne die Variablen aus dem Datensatz
#       TIPP: https://dplyr.tidyverse.org/reference/select.html (select verwenden)
#       TIPP: Verwenden ein - Symbol vor der Variable
#       TIPP: Speichere den Output von select erneut in PISA. Verwende den Pipe-Operator
#       TIPP: Umschließe die Variable mit `variablennamen`. 
```

Nun haben wir alle wichtigen Variablen in unserem Datensatz. Die Variablennamen enthalten allerdings Leerzeichen und sind schwierig zu verstehen. Wir möchten die Variablennamen folgendermaßen ändern:

* Country Name  -> country_name
* Series Name   -> series_name
* 2015 [YR2015] -> score

```{r}
# TODO: Benenne die drei Variablen um
#       TIPP: https://dplyr.tidyverse.org/reference/select.html -> rename Funktion
#       TIPP: Umschließe die alte Variable mit `variable name` (da die Variable leerzeichen enthält)
#       TIPP: der neue Variablenname steht links vom = Zeichen
#       TIPP: Trenne die Änderungen mit einem Komma
#       TIPP: Speichere den Output von select erneut in PISA. Verwende den Pipe-Operator
```

Die Variable score ist immer noch als Character gespeichert. Characters stehen für Zeichenketten. Score ist allerdings ein numerischer Wert. Ändern wir das daher:

```{r}
options(digits=5)
pisa$score <- pisa$score %>% as.double
```

Die Variable series_name enthält sowohl die Domäne (z.B. Mathematik, Lesen) als auch der durchschnittliche Wert des Geschlechts. Damit wir nachher spezifische Aussagen für die Geschlechter machen können, müssen wir diese Variable in zwei Variablen auftrennen (siehe [separate](https://tidyr.tidyverse.org/reference/separate.html)):

```{r}
pisa <- pisa %>% 
  separate(series_name, c("domain", "sex"), sep = "[.]")
```

Wenn wir nun den Dataframe ansehen, stellen wir fest, dass die Variable sex immer noch Leerzeichen enthält. Löschen wir diese:

```{r}
# TODO: Entferne die Leerzeichen in der Variable sex mit mutate und str_trim
#       TIPP: str_trim: https://stringr.tidyverse.org/reference/str_trim.html
#       TIPP: mutate:   https://dplyr.tidyverse.org/reference/mutate.html
#       TIPP: Verwende dieses Template
pisa <- NULL %>%
  NULL(
    sex = sex %>% NULL
  )
```

Zuletzt ist unsere Variable `domain` noch unsauber. Statt `Mean performance on the mathematics scale` möchten wir `mathematics` etc. erhalten. 

```{r}
# TODO: Vervollständige folgenden Code
#       str_extract: https://stringr.tidyverse.org/reference/str_extract.html
pisa <- NULL %>%
  mutate(
    domain = NULL %>% str_extract("(mathematics|reading|science)")
  )
```

Wunderbar, nun haben wir einen sauberen Datensatz und können den Datensatz analysieren


## Explorative Datenanalyse

Zunächst möchten wir wissen, wie viele Länder an der Studie teilgenommen haben:

```{r}
# TODO: Zähle die Länder, die an der Studie teilgenommen haben
#       TIPP: Verwende unique: https://dplyr.tidyverse.org/reference/tally.html
#       TIPP: Verwende length: https://stat.ethz.ch/R-manual/R-devel/library/base/html/length.html
```

Wie gut waren die Studierenden über alle Länder hinweg in den drei Domänen? 

```{r}
# TODO: Berechne den Mittelwert für jedes der drei Domänen
#       TIPP: Nutze group_by: https://dplyr.tidyverse.org/reference/group_by.html
#       TIPP: Nutze summarise: https://dplyr.tidyverse.org/reference/summarise.html
pisa %>% 
  # Wir müssen die Daten nach sex == NA filtern, da
  # uns nur die geschlechts unabhängigen Werte interessieren
  filter(is.na(sex)) %>%
  NULL(domain) %>%
  NULL(mean = NULL %>% NULL(., na.rm = TRUE))
```

Wie stark streuen die Werte für die drei Domänen eigentlich? Erstellen wir einen Boxplot, um die Streuung zu betrachten:

```{r}
# TODO: Vervollständige den Boxplot. Ersetze NULL
#       TIPP: https://ggplot2.tidyverse.org/reference/geom_boxplot.html
ggplot(pisa, aes(x = domain, y = score, fill = NULL)) +
  NULL()
```

Welches Land hat im Leseverständnis am besten abgeschlossen? 

```{r}
# TODO: Sortiere die Leistung der Länder nach dem Leseverständnis ihrer Schüler
reading_score_descending <- pisa %>%
  # Nutze filter, um den Datensatz nach den Lesefertigeiten zu filtern
  filter(is.na(sex), NULL) %>%
  # Sortiere die Werte nach der Lesefähigkeit mit arrange:
  # https://dplyr.tidyverse.org/reference/arrange.html
  NULL(desc(NULL)) %>%
  # Filter die Länder, die fehlende Werte haben (Nutze is.na und ! davor)
  # https://dplyr.tidyverse.org/reference/filter.html
  filter(NULL)
```

Das Ergebnis können wir zum Schluss visualisieren:

```{r}
ggplot(reading_score_descending, aes(reorder(country_name, score), 
                                     score, fill = score)) +
  geom_bar(stat = "identity") + 
  # Das Koordinatensystem umdrehen
  coord_flip() +
  scale_fill_continuous(type = "viridis") +
  guides(fill = FALSE)
```

Können Frauen eigentlich wirklich besser lesen als Männer? 

```{r}
# TODO: Versuche selbstständig aus den Funktionen, die du heute gelernt hast
#       diese Frage zu beantworten. Es genügt, wenn du die Mittelwerte 
#       zwischen Männern und Frauen vergleichst.
#       Wenn du dich richtig herausfordern möchtest. Versuche den Unterschied
#       zwischen MÄnnern und Frauen durch einen Boxplot zu visualiseren.
```




